<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torque</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        :root {
            --bg: #0B0B0F;
            --card: rgba(20, 25, 40, 0.6);
            --neon-cyan: #00FFFF;
            --neon-magenta: #FF00FF;
            --neon-blue: #00D0FF;
            --text: #FFFFFF;
            --text-secondary: #B0B0B0;
        }
        body { margin: 0; font-family: 'Roboto', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; }
        header { padding: 16px; text-align: center; border-bottom: 1px solid rgba(0,255,255,0.2); position: relative; }
        .logo { font-family: 'Orbitron', sans-serif; font-size: 32px; font-weight: bold; background: linear-gradient(to right, var(--neon-cyan), var(--neon-magenta)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .balance { position: absolute; right: 16px; top: 16px; font-size: 14px; }
        main { flex: 1; overflow-y: auto; padding: 16px; }
        .section { display: none; }
        .section.active { display: block; }
        .card { background: var(--card); border-radius: 16px; padding: 16px; margin-bottom: 16px; backdrop-filter: blur(10px); border: 1px solid rgba(0,255,255,0.2); }
        .btn { background: linear-gradient(to right, var(--neon-cyan), var(--neon-blue)); color: black; border: none; padding: 12px 24px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 12px; }
        .btn-secondary { background: rgba(255,0,255,0.2); color: var(--text); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; }
        .car-card { text-align: center; }
        .car-img { width: 100%; height: 120px; object-fit: cover; border-radius: 12px; border: 2px solid var(--neon-cyan); }
        .income { text-align: center; font-size: 24px; margin: 20px 0; }
        .collect-btn { background: linear-gradient(to right, var(--neon-magenta), var(--neon-cyan)); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 10px var(--neon-cyan); } 50% { box-shadow: 0 0 30px var(--neon-cyan); } 100% { box-shadow: 0 0 10px var(--neon-cyan); } }
        .bottom-nav { display: flex; background: var(--card); border-top: 1px solid rgba(0,255,255,0.2); }
        .nav-item { flex: 1; text-align: center; padding: 12px; cursor: pointer; }
        .nav-item.active { color: var(--neon-cyan); border-top: 3px solid var(--neon-cyan); }
        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; z-index: 1000; }
        .placeholder-img { background: linear-gradient(45deg, #111, #222); display: flex; align-items: center; justify-content: center; color: var(--neon-cyan); font-size: 20px; }
        #race-overlay { display: none; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo">TORQUE</div>
        <div class="balance" id="balance">0 $TORQUE</div>
    </header>

    <main>
        <div id="onboarding" class="section active">
            <div style="text-align:center; margin-top:50%">
                <h1 class="logo" style="font-size:48px;">TORQUE</h1>
                <p style="font-size:18px; margin:20px;">Build your crypto garage.<br>Earn while you drift.</p>
                <button class="btn" id="connect-wallet">Connect TON Wallet</button>
                <p style="margin-top:40px; font-size:12px;">Powered by TON ‚Ä¢ Earn real crypto</p>
            </div>
        </div>

        <div id="garage" class="section">
            <div class="income" id="income-display">900 $TORQUE/hr</div>
            <button class="btn collect-btn" id="collect">Collect Rewards</button>
            <div class="grid" id="garage-grid"></div>
            <button class="btn" style="position:fixed; bottom:80px; right:16px; border-radius:50%; width:60px; height:60px; font-size:30px; line-height:60px;">‚ö°</button>
        </div>

        <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã (car-detail, shop, races, profile) ‚Äî –≤—Å—Ç–∞–≤—å –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞, –æ–Ω–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å -->

        <div id="race-overlay" class="overlay">
            <h1>Race Complete!</h1>
            <h2>4 100 points</h2>
            <p>Reward Earned +2050 $TORQUE</p>
            <button class="btn btn-secondary" id="close-race">Close</button>
            <button class="btn" id="race-again">Race Again</button>
        </div>
    </main>

    <div class="bottom-nav">
        <div class="nav-item active" data-section="garage">üè† Garage</div>
        <div class="nav-item" data-section="shop">üõí Shop</div>
        <div class="nav-item" data-section="races">‚ö° Races</div>
        <div class="nav-item" data-section="profile">üë§ Profile</div>
    </div>

    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        const theme = Telegram.WebApp.themeParams;
        document.body.style.backgroundColor = theme.bg_color || '#0B0B0F';
        document.body.style.color = theme.text_color || '#FFFFFF';

        let torque = parseInt(localStorage.getItem('torque') || '0');
        let incomePerHour = parseInt(localStorage.getItem('income') || '900');
        let lastCollect = parseInt(localStorage.getItem('lastCollect') || Date.now());
        let cars = JSON.parse(localStorage.getItem('cars') || '[]');
        let isWalletConnected = localStorage.getItem('walletConnected') === 'true';

        if (cars.length === 0) {
            cars = [
                { name: "Volt Racer", rarity: "Rare", level: 8, income: 900, img: "https://via.placeholder.com/300x200/111/00FFFF?text=Volt+Racer" },
                { name: "Turbo Drift", rarity: "Epic", level: 6, income: 450, img: "https://via.placeholder.com/300x200/111/FF00FF?text=Turbo+Drift" }
            ];
            localStorage.setItem('cars', JSON.stringify(cars));
        }

        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: '/tonconnect-manifest.json',  // –§–∏–∫—Å –∑–¥–µ—Å—å!
            buttonRootId: null
        });

        document.getElementById('connect-wallet').onclick = async () => {
            try {
                await tonConnectUI.connectWallet();
                isWalletConnected = true;
                localStorage.setItem('walletConnected', 'true');
                showSection('garage');
                updateBalance();
            } catch (e) {
                console.error(e);
                alert('Connection failed. Check manifest file.');
            }
        };

        // –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (updateBalance, renderGarage, showSection —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π wallet, race logic, shop –∏ —Ç.–¥.) ‚Äî –æ–Ω –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è.

        if (isWalletConnected) showSection('garage');
        renderGarage();
    </script>
</body>
</html>


